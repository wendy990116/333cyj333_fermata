<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¯æ—¥éŸ³æª”ä¸Šå‚³</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 600;
      font-size: 14px;
    }
    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 15px;
      resize: vertical;
      min-height: 120px;
      font-family: inherit;
      transition: border-color 0.3s;
    }
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    input[type="date"],
    input[type="password"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 15px;
      font-family: inherit;
      transition: border-color 0.3s;
    }
    input[type="date"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: #667eea;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: -9999px;
    }
    .file-input-label {
      display: block;
      padding: 12px;
      border: 2px dashed #e0e0e0;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
    }
    .file-input-label:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }
    .file-name {
      margin-top: 8px;
      color: #667eea;
      font-size: 14px;
      text-align: center;
    }
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      display: block;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      display: block;
    }
    .status.loading {
      background: #d1ecf1;
      color: #0c5460;
      display: block;
    }
    .password-section {
      background: #f8f9ff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .upload-section {
      display: none;
    }
    .upload-section.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ æ¯æ—¥éŸ³æª”ä¸Šå‚³</h1>
    <p class="subtitle">ä¸Šå‚³éŸ³æª” + é€å­—ç¨¿</p>

    <!-- å¯†ç¢¼é©—è­‰å€ -->
    <div class="password-section" id="passwordSection">
      <div class="form-group">
        <label for="password">è«‹è¼¸å…¥ä¸Šå‚³å¯†ç¢¼ï¼š</label>
        <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼" />
      </div>
      <button onclick="checkPassword()">é©—è­‰</button>
    </div>

    <!-- ä¸Šå‚³è¡¨å–®å€ -->
    <div class="upload-section" id="uploadSection">
      <form id="uploadForm">
        <div class="form-group">
          <label for="transcript">ğŸ“„ é€å­—ç¨¿å…§å®¹ï¼š</label>
          <textarea id="transcript" placeholder="è¼¸å…¥ä»Šå¤©çš„é€å­—ç¨¿å…§å®¹..." required></textarea>
        </div>

        <div class="form-group">
          <label for="audioFile">ğŸµ é¸æ“‡éŸ³æª”ï¼š</label>
          <div class="file-input-wrapper">
            <input type="file" id="audioFile" accept="audio/*" required onchange="showFileName()" />
            <label for="audioFile" class="file-input-label">
              é»æ“Šé¸æ“‡éŸ³æª”æª”æ¡ˆ (mp3, wav, m4a...)
            </label>
          </div>
          <div class="file-name" id="fileName"></div>
        </div>

        <div class="form-group">
          <label for="date">ğŸ“… æ—¥æœŸï¼š</label>
          <input type="date" id="date" required />
        </div>

        <button type="submit" id="uploadBtn">ä¸Šå‚³</button>
      </form>

      <div class="status" id="status"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase è¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyAFYAQO__cSHFpZUZbEImfQusyTZoSQ15Y",
      authDomain: "cyj333-g7.firebaseapp.com",
      projectId: "cyj333-g7",
      storageBucket: "cyj333-g7.firebasestorage.app",
      messagingSenderId: "990374083387",
      appId: "1:990374083387:web:e78405fbcc133aed28151e"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const db = firebase.firestore();

    // è¨­å®šä¸Šå‚³å¯†ç¢¼ï¼ˆä½ å¯ä»¥æ”¹æˆä½ æƒ³è¦çš„ï¼‰
    const UPLOAD_PASSWORD = 'cyj333';

    // è¨­å®šä»Šå¤©çš„æ—¥æœŸç‚ºé è¨­å€¼
    document.getElementById('date').valueAsDate = new Date();

    // å¯†ç¢¼é©—è­‰
    function checkPassword() {
      const password = document.getElementById('password').value;
      if (password === UPLOAD_PASSWORD) {
        document.getElementById('passwordSection').style.display = 'none';
        document.getElementById('uploadSection').classList.add('active');
      } else {
        alert('å¯†ç¢¼éŒ¯èª¤ï¼');
      }
    }

    // é¡¯ç¤ºé¸æ“‡çš„æª”æ¡ˆåç¨±
    function showFileName() {
      const fileInput = document.getElementById('audioFile');
      const fileName = document.getElementById('fileName');
      if (fileInput.files.length > 0) {
        fileName.textContent = 'âœ“ ' + fileInput.files[0].name;
      }
    }

    // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = 'status ' + type;
    }

    // è¡¨å–®æäº¤è™•ç†
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const transcript = document.getElementById('transcript').value;
      const audioFile = document.getElementById('audioFile').files[0];
      const date = document.getElementById('date').value;
      const uploadBtn = document.getElementById('uploadBtn');

      if (!audioFile) {
        showStatus('è«‹é¸æ“‡éŸ³æª”æª”æ¡ˆ', 'error');
        return;
      }

      try {
        // ç¦ç”¨æŒ‰éˆ•
        uploadBtn.disabled = true;
        showStatus('ä¸Šå‚³ä¸­...', 'loading');

        // 1. ä¸Šå‚³éŸ³æª”åˆ° Storage
        const fileName = `${date}_${audioFile.name}`;
        const storageRef = storage.ref('audio/' + fileName);
        const uploadTask = await storageRef.put(audioFile);
        
        // 2. å–å¾—éŸ³æª”ä¸‹è¼‰ç¶²å€
        const audioUrl = await uploadTask.ref.getDownloadURL();

        // 3. æ–°å¢è¨Šæ¯åˆ° Firestore
        await db.collection('messages').add({
          text: transcript,
          audioUrl: audioUrl,
          createdAt: firebase.firestore.Timestamp.fromDate(new Date(date))
        });

        showStatus('âœ“ ä¸Šå‚³æˆåŠŸï¼', 'success');
        
        // æ¸…ç©ºè¡¨å–®
        document.getElementById('uploadForm').reset();
        document.getElementById('fileName').textContent = '';
        document.getElementById('date').valueAsDate = new Date();

      } catch (error) {
        console.error('ä¸Šå‚³å¤±æ•—:', error);
        showStatus('ä¸Šå‚³å¤±æ•—ï¼š' + error.message, 'error');
      } finally {
        uploadBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
